<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}">

<head>
    <th:block layout:fragment="head">
        <title>Registrar Producto</title>
    </th:block>
</head>

<body>
    <div layout:fragment="content" class="container mt-5">
        <h2 class="mb-4"><i class="bi bi-box-seam"></i> Registrar Producto</h2>

        <!-- Mensajes de error -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Mensaje de éxito -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <form th:action="@{/productos/save}" method="post" th:object="${producto}">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <strong><i class="bi bi-info-circle"></i> Datos del Producto</strong>
                </div>
                <div class="card-body">
                    <div class="row g-3">

                        <div class="col-md-6">
                            <label for="codProducto" class="form-label">Código <span
                                    class="text-danger">*</span></label>
                            <input type="text" id="codProducto" name="codProducto" class="form-control"
                                th:value="*{codProducto}" readonly />
                        </div>

                        <div class="col-md-6">
                            <label for="nombreProducto" class="form-label">Nombre <span
                                    class="text-danger">*</span></label>
                            <input type="text" id="nombreProducto" name="nombreProducto" class="form-control" required
                                th:value="*{nombreProducto}" />
                        </div>

                        <!-- Campo Descripción y Precio -->
                        <div class="col-md-6">
                            <label for="descripcionProducto" class="form-label">Descripción</label>
                            <input type="text" id="descripcionProducto" name="descripcionProducto" class="form-control"
                                th:value="*{descripcionProducto}" />
                        </div>

                        <div class="col-md-6">
                            <label for="precioUnitario" class="form-label">Precio Unitario <span
                                    class="text-danger">*</span></label>
                            <input type="number" step="0.01" id="precioUnitario" name="precioUnitario"
                                class="form-control" required th:value="*{precioUnitario}" />
                        </div>

                        <div class="col-md-6">
                            <label for="stock" class="form-label">Stock</label>
                            <input type="number" id="stock" name="stock" class="form-control" th:value="*{stock}" />
                        </div>

                        <!-- Unidad de medida -->
                        <div class="col-md-6">
                            <label for="unidadMedida" class="form-label">Unidad de Medida</label>
                            <select id="unidadMedida" name="unidadMedida.id" class="form-select">
                                <option value="" disabled selected>Seleccione...</option>
                                <option th:each="u : ${unidades}" th:value="${u.id}" th:text="${u.descripcion}">
                                </option>
                            </select>
                        </div>

                        <!-- Sucursal -->
                        <div class="col-md-6">
                            <label for="sucursal" class="form-label">Sucursal</label>
                            <select name="sucursal.idSucursal" class="form-select" required>
                                <option value="" disabled selected>Seleccione...</option>
                                <option th:each="s : ${sucursales}" th:value="${s.idSucursal}"
                                    th:text="${s.nombreSucursal}"
                                    th:selected="${producto.sucursal != null} ? ${s.idSucursal} == ${producto.sucursal.idSucursal} : false">
                                </option>
                            </select>
                        </div>

                        <!-- Categoría -->
                        <div class="col-md-6">
                            <label for="categoria" class="form-label">Categoría</label>
                            <select name="categoria.id" class="form-select" required>
                                <option value="" disabled selected>Seleccione...</option>
                                <option th:each="c : ${categorias}" th:value="${c.id}" th:text="${c.descripcion}"
                                    th:selected="${producto.categoria != null} ? ${c.id} == ${producto.categoria.id} : false">
                                </option>
                            </select>
                        </div>

                        <!-- Proveedor -->
                        <div class="col-md-6">
                            <label for="proveedor" class="form-label">Proveedor</label>
                            <select name="proveedor.id" class="form-select" required>
                                <option value="" disabled selected>Seleccione...</option>
                                <option th:each="p : ${proveedores}" th:value="${p.id}"
                                    th:text="${p.empresa.razonSocial}"
                                    th:selected="${producto.proveedor != null} ? ${p.id} == ${producto.proveedor.id} : false">
                                </option>
                            </select>
                        </div>

                        <!-- Estado oculto -->
                        <input type="hidden" name="idEstado" value="1" />


                    </div>
                </div>
            </div>

            <!-- Botones -->
            <div class="text-end">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Guardar
                </button>
                <a th:href="@{/productos}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left-circle"></i> Cancelar
                </a>
            </div>
        </form>
    </div>

    <th:block layout:fragment="js"></th:block>
</body>

</html>